# Write a simple github action to run the tests
name: Run tests

# This means that the action will run on every push and pull request
on: [push, pull_request]

# Each workflow is made up of one or more jobs. Each job is a set of steps that are run sequentially
# The job is run on a fresh instance of the virtual environment
jobs:
  # This job sets up the environment and runs the tests
  setup_ubuntu:
    name: Setup Environment
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    # The steps that the job will run
    steps:
      # An action is a piece of code that performs one single task
      # uses keyword is used to specify the action
      # This action checks out the repository to the runner
      # Actions are stored in the .github/actions directory
      # The checkout action is stored in the actions/checkout repository
      # The v2 tag specifies the version of the action
      - uses: actions/checkout@v2
      # This action sets up python on the runner
      - uses: actions/setup-python@v1
        with:
          python-version: 3.8
      # This action installs the dependencies
      - name: Install dependencies
        # The run keyword is used to specify the command to run
        # The command is run in the default shell
        run: |
          python3 -m venv venv
          source venv/bin/activate
          python3 -m pip install --upgrade pip
          pip install pytest
          pip install -r requirements.txt
      # This action runs the tests
      - name: Run tests
        run: |
          env | sort
          python3 -m pytest tests.py

  # This job sets up the environment and runs the tests
  setup_windows:
    name: Setup Environment
    # The type of runner that the job will run on
    runs-on: windows-latest
    # The steps that the job will run
    steps:
      # An action is a piece of code that performs one single task
      # uses keyword is used to specify the action
      # This action checks out the repository to the runner
      # Actions are stored in the .github/actions directory
      # The checkout action is stored in the actions/checkout repository
      # The v2 tag specifies the version of the action
      - uses: actions/checkout@v2
      # This action sets up python on the runner
      - uses: actions/setup-python@v1
        with:
          python-version: 3.8
      # This action installs the dependencies
      - name: Install dependencies
        # The run keyword is used to specify the command to run
        # The command is run in the default shell
        run: |
          python -m venv venv
          venv\Scripts\activate
          python -m pip install --upgrade pip
          pip install pytest
          pip install -r requirements.txt
      # This action runs the tests
      - name: Run tests
        run: |
          "Get-ChildItem Env: | Sort-Object Name"
          python -m pytest tests.py
